FROM python:3.10

WORKDIR /app

ARG DB_NAME
ARG DB_USER
ARG DB_PASSWORD
ARG DB_HOST
ARG DB_PORT
ARG SECRET_KEY
ARG DEBUG
ARG DJANGO_SETTINGS_MODULE
ARG REDIS_HOST $REDIS_HOST

ENV DB_NAME $DB_NAME
ENV DB_USER $DB_USER
ENV DB_PASSWORD $DB_PASSWORD
ENV DB_HOST $DB_HOST
ENV DB_PORT $DB_PORT
ENV SECRET_KEY $SECRET_KEY
ENV DEBUG $DEBUG
ENV DJANGO_SETTINGS_MODULE $DJANGO_SETTINGS_MODULE
ENV REDIS_HOST $REDIS_HOST

COPY ./photoapp /app

RUN pip install -r requirements.txt

CMD ["bash", "-c", "celery -A photoapp worker -l info"]

EXPOSE 8000 8001